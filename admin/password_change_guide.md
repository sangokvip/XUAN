# 管理员密码修改功能说明

## 功能概述

管理员后台现已集成密码修改功能，位于"系统设置"页面的"账户安全"部分。

## 功能特点

### 🔐 安全特性
- **当前密码验证**：修改前必须输入正确的当前密码
- **密码强度检查**：新密码必须满足最小长度要求
- **密码确认**：需要两次输入新密码确保一致性
- **自动退出**：密码修改成功后自动清除会话，需要重新登录

### 🎯 用户体验
- **实时验证**：前端JavaScript实时检查密码一致性
- **友好提示**：清晰的错误信息和成功提示
- **响应式设计**：适配各种屏幕尺寸
- **操作确认**：修改前弹出确认对话框

## 使用步骤

### 1. 访问设置页面
- 登录管理员后台
- 点击左侧菜单"系统设置"
- 找到"账户安全"部分

### 2. 修改密码
- 输入当前密码
- 输入新密码（至少6个字符）
- 确认新密码
- 点击"修改密码"按钮
- 确认操作

### 3. 重新登录
- 密码修改成功后会自动退出
- 使用新密码重新登录

## 技术实现

### 后端处理
```php
// 密码验证
verifyPassword($currentPassword, $admin['password_hash'])

// 密码加密
hashPassword($newPassword)

// 数据库更新
$db->update('admins', ['password_hash' => $hashedPassword], 'id = ?', [$adminId])

// 安全退出
session_destroy()
```

### 前端验证
- 密码长度检查
- 密码一致性验证
- 表单提交确认

### 安全措施
- 使用PHP的`password_hash()`函数加密
- 使用`password_verify()`函数验证
- 修改后强制重新登录
- 防止CSRF攻击

## 测试功能

### 测试页面
访问 `admin/test_password_change.php` 可以：
- 查看当前管理员信息
- 测试密码验证功能
- 获取详细的测试指导

### 测试步骤
1. 在测试页面验证当前密码
2. 前往设置页面修改密码
3. 重新登录验证新密码
4. 再次测试确认功能正常

## 故障排除

### 常见问题

**Q: 忘记当前密码怎么办？**
A: 可以通过数据库直接重置密码哈希值，或联系系统管理员。

**Q: 密码修改后无法登录？**
A: 检查新密码是否正确，确认没有大小写错误。

**Q: 提示"当前密码不正确"？**
A: 确认输入的是正确的当前密码，注意大小写。

### 数据库重置密码
如果需要通过数据库重置密码：
```sql
-- 重置为 "admin123"
UPDATE admins SET password_hash = '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi' WHERE id = 1;
```

## 文件清单

### 修改的文件
- `admin/settings.php` - 添加密码修改功能
- `auth/admin_login.php` - 支持密码修改成功消息显示

### 新增的文件
- `admin/test_password_change.php` - 密码修改测试页面
- `admin/password_change_guide.md` - 功能说明文档

## 安全建议

1. **定期修改密码**：建议每3-6个月修改一次管理员密码
2. **使用强密码**：包含大小写字母、数字和特殊字符
3. **不要重复使用密码**：避免与其他账户使用相同密码
4. **保护登录环境**：确保在安全的网络环境下操作

## 更新日志

- **2024-12-XX**：添加管理员密码修改功能
- 集成到系统设置页面
- 添加安全验证和用户体验优化
- 创建测试工具和文档
